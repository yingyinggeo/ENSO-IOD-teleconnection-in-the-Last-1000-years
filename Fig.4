load Vol_type.mat;
load Vol_eruption_global.mat;

vol(isnan(type)) = nan;
tropical = find(type==0);
northern = find(type==1);
southern = find(type== -1);
yr = 850:2005;

load('/Users/yingyingfeng/Downloads/Data/Paleo3bs_Project/sst_idx_850-2005_ILME_FULL_15ens.mat')
sst_idx_real = sst_idx;
sst_idx_real(:,1:5,:) = sst_idx_real(:,1:5,:) - 273.15; 
sst_idx_real(:,7:11,:) = sst_idx_real(:,7:11,:) - 273.15; 

for irun = 1:size(sst_idx_real,3)
    sst_idx_run = sst_idx_real(:,:,irun);
    %Nino
    Nino_mon_re = reshape(sst_idx_run(:,1),12,size(sst_idx_run,1)./12);
    Nino_series = squeeze(nanmean([Nino_mon_re(12,1:end-1);Nino_mon_re(1:2,2:end)],1))';

    %ATL3
    ATL3_mon_re = reshape(sst_idx_run(:,9),12,size(sst_idx_run,1)./12);
    ATL3_series = squeeze(nanmean([ATL3_mon_re(12,1:end-1);ATL3_mon_re(1:2,2:end)],1))';

    %TNA
    TNA_mon_re = reshape(sst_idx_run(:,2),12,size(sst_idx_run,1)./12);
    TNA_series = nanmean(TNA_mon_re(3:5,:),1)';

    %AMO
    AMO_mon_re = reshape(sst_idx_run(:,11),12,size(sst_idx_run,1)./12);
    AMO_series = nanmean(AMO_mon_re(1:12,:),1)';

    %IOB
    IOB_mon_re = reshape(sst_idx_run(:,3),12,size(sst_idx_run,1)./12);
    IOB_series = nanmean(IOB_mon_re(3:5,:),1)';

    %WTIO
    WTIO_mon_re = reshape(sst_idx_run(:,4),12,size(sst_idx_run,1)./12);
    WTIO_series = nanmean(WTIO_mon_re(9:11,:),1)';

    %ETIO
    ETIO_mon_re = reshape(sst_idx_run(:,5),12,size(sst_idx_run,1)./12);
    ETIO_series = nanmean(ETIO_mon_re(9:11,:),1)';
    %IOD
    IOD_series = WTIO_series - ETIO_series;

    data_series = nan(size(IOD_series,1),8);
    data_series(1:end-1,1) = Nino_series;
    data_series(:,2) = TNA_series;
    data_series(1:end-1,3) = ATL3_series;
    data_series(:,4) = AMO_series;

    data_series(:,5) = IOB_series;
    data_series(:,6) = IOD_series;
    data_series(:,7) = WTIO_series;
    data_series(:,8) = ETIO_series;

 
    yr = 850:2005';
    data_std = nan(size(yr,2),8);
    for iseries = 1:8
        tmp_series = data_series(:,iseries);
        for iwd = 6:1151
            series_wd = tmp_series(iwd-5:iwd+5,1);  %%%%%%%%%%%%%%%remember change%%%%%%%%%
            series_std = nanstd(series_wd);
            data_std(iwd,iseries) = series_std; clear series_std;
            data_avg(iwd,iseries) = nanmean(series_wd);
        end
    end

    data_series_ens(:,:,irun) = data_series;
    data_std_ens(:,:,irun) = data_std;
    data_avg_ens(:,:,irun) = data_avg;
end

%save avg_std_full.mat data_avg_ens data_std_ens;

for inum = 1:8
    clear tmp;
    tmp = squeeze(data_series_ens(:,inum,:));
    tmp_std = squeeze(data_std_ens(:,inum,:));
    data_series_avg = nanmean(tmp,2);
    avg_std = std(tmp,0,2);
    data_series_std(:,inum) = nanmean(tmp_std,2);
end

%% Granger causality calculate
load('/Users/yingyingfeng/Downloads/Data/Paleo3bs_Project/sst_idx_850-2005_ILME_FULL_15ens.mat');
sst_idx_real = sst_idx;
sst_idx_real(:,1:5,:) = sst_idx(:,1:5,:)-273.15;
Nino_series = squeeze(sst_idx(:,1,:));
TNA_series = squeeze(sst_idx(:,2,:));
IOD_series = squeeze(sst_idx(:,6,:));
IOB_series = squeeze(sst_idx(:,3,:));
yr = 850:2005; yr = yr';

s = [1156,15];
F12 = nan(s(1),s(2));
F21 = nan(s(1),s(2));
sig12 = nan(s(1),s(2));
sig21 = nan(s(1),s(2));
order_result = nan(s(1),s(2));

for iens = 1:15
    for iwd = 16:1141
        clear Nino_zscore; clear Nino_anomaly; clear Nino_detrend;
        clear TNA_zscore; clear TNA_anomaly; clear TNA_detrend;
        clear IOD_zscore; clear IOD_anomaly; clear IOD_detrend;

        clear tmp; clear tmp_re; clear tmp_re_rownmean; clear tmp_re_anomaly;
        pd = (iwd-15)*12+1:(iwd+15)*12;
        tmp = Nino_series(pd ,iens);
        tmp_re = reshape(tmp,12,size(pd,2)/12);
        tmp_re_rownmean = nanmean(tmp_re,2);
        tmp_re_anomaly = tmp_re - tmp_re_rownmean;
        Nino_anomaly = reshape(tmp_re_anomaly,size(pd,2),1);
        Nino_detrend = detrend(Nino_anomaly);
        Nino_zscore = zscore(Nino_detrend);
        clear tmp; clear tmp_re; clear tmp_re_rownmean; clear tmp_re_anomaly;

        tmp = TNA_series(pd ,iens);
        tmp_re = reshape(tmp,12,size(pd,2)/12);
        tmp_re_rownmean = nanmean(tmp_re,2);
        tmp_re_anomaly = tmp_re - tmp_re_rownmean;
        TNA_anomaly = reshape(tmp_re_anomaly,size(pd,2),1);
        TNA_detrend = detrend(TNA_anomaly);
        TNA_zscore = zscore(TNA_detrend);
        clear tmp; clear tmp_re; clear tmp_re_rownmean; clear tmp_re_anomaly;

        tmp = IOD_series(pd ,iens);
        tmp_re = reshape(tmp,12,size(pd,2)/12);
        tmp_re_rownmean = nanmean(tmp_re,2);
        tmp_re_anomaly = tmp_re - tmp_re_rownmean;
        IOD_anomaly = reshape(tmp_re_anomaly,size(pd,2),1);
        IOD_detrend = detrend(IOD_anomaly);
        IOD_zscore = zscore(IOD_detrend());
        clear tmp; clear tmp_re; clear tmp_re_rownmean; clear tmp_re_anomaly;

        tmp = IOB_series(pd ,iens);
        tmp_re = reshape(tmp,12,size(pd,2)/12);
        tmp_re_rownmean = nanmean(tmp_re,2);
        tmp_re_anomaly = tmp_re - tmp_re_rownmean;
        IOB_anomaly = reshape(tmp_re_anomaly,size(pd,2),1);
        IOB_detrend = detrend(IOB_anomaly);
        IOB_zscore = zscore(IOB_detrend());
        clear tmp; clear tmp_re; clear tmp_re_rownmean; clear tmp_re_anomaly;


        ntrials   = 1;
        nobs      = size(pd,2);

        regmode   = 'OLS';  % VAR model estimation regression mode ('OLS', 'LWR' or empty for default)
        icregmode = 'LWR';  % information criteria regression mode ('OLS', 'LWR' or empty for default)

        momax     = 12;     % maximum model order for model order estimation

        acmaxlags = 1000;   % maximum autocovariance lags (empty for automatic calculation)

        tstat     = '';     % statistical test for MVGC:  'F' for Granger's F-test (default) or 'chi2' for Geweke's chi2 test
        alpha     = 0.05;   % significance level for significance test
        mhtc      = 'FDR';  % multiple hypothesis test correction (see routine 'significance')
        nvars     = 2;

        disp(['Processing pixel ' ':'  ' iwindow' num2str(iwd)   ' ...']);
        X(1,:) = squeeze(Nino_zscore)';
        X(2,:) = squeeze(IOD_zscore)';

        index = find(isnan(X(1,:)));

            [AIC,BIC,moAIC,moBIC] = tsdata_to_infocrit(X,momax,icregmode);
            morder = moAIC;
            [A,SIG] = tsdata_to_var(X,morder,regmode);

            if isbad(A)
                fprintf(2,' *** skipping - VAR estimation failed\n');
                continue
            end

            [G,info] = var_to_autocov(A,SIG);
            if info.warnings ~=0 && info.error ~=0
                fprintf(2,' *** skipping - var_to_autocov\n');
                continue
            end

            FF = autocov_to_pwcgc(G);
            tmp = ~isbad(FF,false);
            if tmp ==0
                fprintf(2,' *** skipping - warning autocov_to_pwcgc\n');
                continue
            end

            F12(iwd,iens) = FF(1,2); % estimated GC 2 -> 1  Nino series to SST
            F21(iwd,iens) = FF(2,1); % estimated GC 1 -> 2  SST to Nino series

            pval = mvgc_pval(FF,morder,nobs,ntrials,1,1,nvars-2,tstat);
            sig  = significance(pval,alpha,mhtc);
            order_result(iwd,iens) = moAIC;

            sig12(iwd,iens) = sig(1,2);
            sig21(iwd,iens) = sig(2,1);
 
    end
end

 save Granger_NINOIOD_30yr.mat F12 F21 sig12 sig21 order_result;
 %% 主图
% External forcing - 太阳辐射
ssi = ncread('SOLAR_SPECTRAL_VK_Lean_849-2008_annual_c130909.nc','ssi');
wvl = ncread('SOLAR_SPECTRAL_VK_Lean_849-2008_annual_c130909.nc','wvl');
time = ncread('SOLAR_SPECTRAL_VK_Lean_849-2008_annual_c130909.nc','time');
date = ncread('SOLAR_SPECTRAL_VK_Lean_849-2008_annual_c130909.nc','date');

wvl_rep = repmat(wvl, 1,1160);

for iyear = 1:1160    
        ssi_iyear = squeeze(ssi(:,iyear));
        ttl(iyear,1) = sum(ssi_iyear.*wvl);
end

TSI = ttl(2:1157,1);
save TSI_850_2005.mat TSI;

%%温室气体
co2 = ncread('ghg_pmip3_850-2007_annual_c100517.v1.nc','CO2');
ch4 = ncread('ghg_pmip3_850-2007_annual_c100517.v1.nc','CH4');
n2o = ncread('ghg_pmip3_850-2007_annual_c100517.v1.nc','N2O');
date = ncread('ghg_pmip3_850-2007_annual_c100517.v1.nc','date');

CO2 = co2(1:1156,1); CH4 = ch4(1:1156,1); N2O = n2o(1:1156,1);
% load data
load TSI_850_2005.mat TSI;
co2 = ncread('ghg_pmip3_850-2007_annual_c100517.v1.nc','CO2');
ch4 = ncread('ghg_pmip3_850-2007_annual_c100517.v1.nc','CH4');
n2o = ncread('ghg_pmip3_850-2007_annual_c100517.v1.nc','N2O');
date = ncread('ghg_pmip3_850-2007_annual_c100517.v1.nc','date');
CO2 = co2(1:1156,1); CH4 = ch4(1:1156,1); N2O = n2o(1:1156,1);

load('Granger_NINOTNA_30yr.mat');
% load('Granger_NINOTNA_30yr.mat')
R_Nino2TNA = F21;
P_Nino2TNA = sig21;
R_TNA2Nino = F12;
P_TNA2Nino = sig21;
clear F21; clear F12; clear sig21; clear sig12;


% load('Granger_NINOIOB_30yr.mat');
load('Granger_NINOIOD_30yr.mat')
R_Nino2IOB = F21;
P_Nino2IOB = sig21;
clear F21; clear F12; clear sig21; clear sig12;
%%
%
load Vol_type.mat;
load Vol_eruption_global.mat;

vol(isnan(type)) = nan;
tropical = find(type==0);
northern = find(type==1);
southern = find(type== -1);


page_width = 18; page_height = 18;
figure('Units','centimeters',...
    'position',[0 0 page_width page_height],...
    'PaperPosition',[0 0 page_width page_height],...
    'color',[1 1 1]);

xstart = 0.125 ; ystart = 0.05;
height = 0.175; width =0.75; epsx = 0.13;  epsy = 0;
nrow = 5; ncol = 1;
pos = zeros(nrow*ncol,4);
for r0 = 1:nrow
    for c = 1:ncol
        n = (r0-1)*ncol+c;
        pos(n,1) = xstart + (c-1)*width + (c-1)*epsx;
        pos(n,2) = 1 - (ystart + r0*height + (r0-1)*epsy);
        pos(n,3) = width;
        pos(n,4) = height;
    end
end

yr_inum = 1:1126;
color_line =  [[0 73 195]./255;  [0 116 195]./255; [100 30 181]./255;  [103, 116, 176]./255;   [0.4 0.4 0.4]];
color_patch = [[0 73 195]./255;  [0 116 195]./255; [100 30 181]./255;  [103, 116, 176]./255;   [0.3 0.3 0.3]];
Label = {'a','b','c','d','e'};

for inum = 1:5
    %

    clear tmp;

    if inum==1
        ax2 = axes('Position',pos(inum,:));
        vol_tropical = zeros(1151,1); vol_tropical(tropical) = vol(tropical);
        vol_northern = zeros(1151,1); vol_northern(northern) = vol(northern);
        vol_southern = zeros(1151,1); vol_southern(southern) = vol(southern);

        b1 = bar(ax2, 1:1151, vol_tropical, 5, 'FaceColor',[.4 .4 .4],'EdgeColor','none');
        hold on;
        b2 =bar(ax2,  1:1151, vol_northern, 5, 'FaceColor',[.4 .4 .4],'EdgeColor','none');
        hold on;
        b3 =bar(ax2,  1:1151, vol_southern, 5,'FaceColor',[.4 .4 .4],'EdgeColor','none');

        hold on;
        scatter(ax2,tropical,vol(tropical)+1, 30,'x','Color',[217 83 25]./255); hold on;
        scatter(ax2,northern,vol(northern)+1, 10,'^','MarkerFaceColor',[237 177 36]./255,'MarkerEdgeColor','none'); hold on;
        scatter(ax2,southern,vol(southern)+1, 10,'v','MarkerFaceColor',[0 114 189]./255,'MarkerEdgeColor','none'); hold on;

        set(gca,'XLim',[1 1156],'XTick',[]);
        set(gca,'YAxisLocation','right');
        box off;
        set(gca,'Color','none','XColor','none');
        hold on;
        set(ax2, 'YLim',[0 300],'YTick',50:50:250, 'TickDir','out','TickLength',[0.004/0.5, 0], 'fontname','Helvetica','fontsize',12,'yticklabel',{'','100','','200',''});
        ylabel({'Volcanic Mass'},'fontname','Helvetica','fontsize',12,'Color',[.4 .4 .4]);   %%%%%%%%%%%%%%%remember change%%%%%%%%%

        ax= axes('Position',pos(inum,:),'Color','none');
        hold on;
        tmp = squeeze(data_avg_ens(:,1,:));
        tmp(tmp==0) = nan;
        data_series_avg = nanmean(tmp,2)-nanmean(tmp,'all');
        avg_std = std(tmp,0,2);

        fh = fill([6:1150, fliplr(6:1150)], [(data_series_avg(6:1150,1)+avg_std(6:1150,1))', fliplr((data_series_avg(6:1150,1)-avg_std(6:1150,1))')], color_patch(inum,:));
        set(fh,'FaceColor', color_patch(inum,:),'FaceAlpha',0.25,'EdgeColor','none','EdgeAlpha',0.4,'Linestyle','--');
        plot(ax,6:1150, data_series_avg(6:1150,1), '-', 'Color', color_line(inum,:), 'LineWidth', 1, 'LineJoin' ,'miter'); %855-1999
        hold on;
        set(ax, 'YLim',[-1 1],'YTick',-0.5:0.5:0.5, 'TickDir','out','TickLength',[0.006/0.5, 0],'yticklabel',{'-0.5','0','0.5'});
        set(ax, 'XLim',[1 1156],'XTick',51:100:1156, 'TickDir','out','TickLength',[0.006/0.5, 0],'xticklabel',{'','','','','','','','','','','',''},'FontName','Helvetica','FontSize',12);

    end

    if inum==2
        ax2 = axes('Position',pos(inum,:));
        vol_tropical = zeros(1151,1); vol_tropical(tropical) = vol(tropical);
        vol_northern = zeros(1151,1); vol_northern(northern) = vol(northern);
        vol_southern = zeros(1151,1); vol_southern(southern) = vol(southern);

        b1 = bar(ax2, 1:1151, vol_tropical, 5, 'FaceColor',[.4 .4 .4],'EdgeColor','none');
        hold on;
        b2 =bar(ax2,  1:1151, vol_northern, 5, 'FaceColor',[.4 .4 .4],'EdgeColor','none');
        hold on;
        b3 =bar(ax2,  1:1151, vol_southern, 5,'FaceColor',[.4 .4 .4],'EdgeColor','none');

        hold on;
        scatter(ax2,tropical,vol(tropical)+1, 30,'x','Color',[217 83 25]./255); hold on;
        scatter(ax2,northern,vol(northern)+1, 10,'^','MarkerFaceColor',[237 177 36]./255,'MarkerEdgeColor','none'); hold on;
        scatter(ax2,southern,vol(southern)+1, 10,'v','MarkerFaceColor',[0 114 189]./255,'MarkerEdgeColor','none'); hold on;

        set(gca,'XLim',[1 1156],'XTick',[]);
        set(gca,'YAxisLocation','right');
        box off;
        set(gca,'Color','none','XColor','none');
        hold on;
        set(ax2, 'YLim',[0 300],'YTick',50:50:250, 'TickDir','out','TickLength',[0.004/0.5, 0], 'fontname','Helvetica','fontsize',12,'yticklabel',{'','100','','200',''});
        ylabel({'Volcanic Mass'},'fontname','Helvetica','fontsize',12,'Color',[.4 .4 .4]);   %%%%%%%%%%%%%%%remember change%%%%%%%%%

        ax= axes('Position',pos(inum,:),'Color','none');
        hold on;
        tmp = squeeze(data_avg_ens(:,1,:));
        tmp(tmp==0) = nan;
        data_series_avg = nanmean(tmp,2)-nanmean(tmp,'all');
        avg_std = std(tmp,0,2);

        fh = fill([6:1150, fliplr(6:1150)], [(data_series_avg(6:1150,1)+avg_std(6:1150,1))', fliplr((data_series_avg(6:1150,1)-avg_std(6:1150,1))')], color_patch(inum,:));
        set(fh,'FaceColor', color_patch(inum,:),'FaceAlpha',0.25,'EdgeColor','none','EdgeAlpha',0.4,'Linestyle','--');
        plot(ax,6:1150, data_series_avg(6:1150,1), '-', 'Color', color_line(inum,:), 'LineWidth', 1, 'LineJoin' ,'miter'); %855-1999
        hold on;
        set(ax, 'YLim',[-0.8 0.8],'YTick',-0.5:0.5:0.5, 'TickDir','out','TickLength',[0.006/0.5, 0],'yticklabel',{'0.4','0.6'});
        set(ax, 'XLim',[1 1156],'XTick',51:100:1156, 'TickDir','out','TickLength',[0.006/0.5, 0],'xticklabel',{'','','','','','','','','','','',''},'FontName','Helvetica','FontSize',12);
    end

    if inum == 3

        ax2 = axes('Position',pos(inum,:));
        vol_tropical = zeros(1151,1); vol_tropical(tropical) = vol(tropical);
        vol_northern = zeros(1151,1); vol_northern(northern) = vol(northern);
        vol_southern = zeros(1151,1); vol_southern(southern) = vol(southern);

        b1 = bar(ax2, 1:1151, vol_tropical, 5, 'FaceColor',[.4 .4 .4],'EdgeColor','none');
        hold on;
        b2 =bar(ax2,  1:1151, vol_northern, 5, 'FaceColor',[.4 .4 .4],'EdgeColor','none');
        hold on;
        b3 =bar(ax2,  1:1151, vol_southern, 5,'FaceColor',[.4 .4 .4],'EdgeColor','none');

        hold on;
        scatter(ax2,tropical,vol(tropical)+1, 30,'x','Color',[217 83 25]./255); hold on;
        scatter(ax2,northern,vol(northern)+1, 10,'^','MarkerFaceColor',[237 177 36]./255,'MarkerEdgeColor','none'); hold on;
        scatter(ax2,southern,vol(southern)+1, 10,'v','MarkerFaceColor',[0 114 189]./255,'MarkerEdgeColor','none'); hold on;

        set(gca,'XLim',[1 1156],'XTick',[]);
        set(gca,'YAxisLocation','right');
        box off;
        set(gca,'Color','none','XColor','none');
        hold on;
        set(ax2, 'YLim',[0 300],'YTick',50:50:250, 'TickDir','out','TickLength',[0.004/0.5, 0], 'fontname','Helvetica','fontsize',12,'yticklabel',{'','100','','200',''});
        ylabel({'Volcanic Mass'},'fontname','Helvetica','fontsize',12,'Color',[.4 .4 .4]);   %%%%%%%%%%%%%%%remember change%%%%%%%%%

        ax= axes('Position',pos(inum,:),'Color','none');

        hold on;
        fh = fill([16:1140, fliplr(16:1140)], [(nanmean(R_Nino2IOB(16:1140,:),2)+nanstd(R_Nino2IOB(16:1140,:),[],2))', fliplr( (nanmean(R_Nino2IOB(16:1140,:),2)-nanstd(R_Nino2IOB(16:1140,:),[],2))' ) ], [84 147 77]./255);

        set(fh,'FaceColor', [84 147 77]./255,'FaceAlpha',0.25,'EdgeColor','none','EdgeAlpha',0.4,'Linestyle','--');
        hold on;
        plot(ax,16:1140, nanmean(R_Nino2IOB(16:1140,:),2), '-', 'Color', [84 147 77]./255, 'LineWidth', 1.5, 'LineJoin' ,'miter');

        % y_midwarm = [nanmean(R_Nino2IOB(51:450,:),[1 2]) nanmean(R_Nino2IOB(51:450,:),[1 2])];
        % y_LIA = [nanmean(R_Nino2IOB(451:1001,:),[1 2]) nanmean(R_Nino2IOB(451:1001,:),[1 2])];
        % y_indus = [nanmean(R_Nino2IOB(1002:1140,:),[1 2]) nanmean(R_Nino2IOB(1002:1140,:),[1 2])];
        % x_midwarm = [51 450];
        % x_LIA = [451 1001];
        % x_indus = [1002 1140];
        %
        % clear p; clear f;
        % p = polyfit(1002:1140,nanmean(R_Nino2IOB(1002:1140,:),2),1);
        % f = polyval(p,1002:1140);
        % plot(1002:1140,f,'-','LineWidth',1.5,'Color',[110 110 110]./255) ;
        % x11 = (1:139)';
        % y11 = nanmean(R_Nino2IOB(1002:1140,:),2);
        % X = [x11 ones(size(x11))];  % 设计矩阵，包含截距项
        %
        % % 使用 regress 计算回归系数及其统计显著性
        % [b,~,~,~,stats] = regress(y11, X);
        % disp(['p-value: ', num2str(stats(3))]);

        % line(x_midwarm,y_midwarm,'Color',[0 0 0],'LineStyle','--','LineWidth',1.5);
        % hold on;
        % line(x_LIA,y_LIA,'Color','b','LineStyle','--','LineWidth',1.5);
        % hold on;
        % line(x_indus, y_indus,'Color',[255 110 93]./255,'LineStyle','--','LineWidth',1.5 )

        set(ax, 'YLim',[0 0.12],'YTick',0:0.04:0.12, 'TickDir','out','TickLength',[0.004/0.5, 0], 'fontname','Helvetica','fontsize',12, 'yticklabel',{'','0.04','0.08',''}); %%%%%%%%%%%%%%%remember change%%%%%%%%%
        set(ax, 'XLim',[1 1156],'XTick',51:50:1156-50, 'TickDir','out','TickLength',[0.006/0.5, 0], 'fontname','Helvetica','fontsize',10,'xticklabel',{'','','','','','','','','','','','','','','','','','','','','',''},'FontName','Helvetica','FontSize',12);
    end
    %
    %
    if inum == 4
        ax = axes('Position',pos(inum,:),'Color','none');
        plot(ax,1:1156, zscore(TSI), '-', 'Color', [74 32 1]./255, 'LineWidth', 1, 'LineJoin' ,'miter');
        set(ax, 'XLim',[1 1156],'XTick',51:50:1156-50, 'TickDir','out','TickLength',[0.006/0.5, 0], 'fontname','Helvetica','fontsize',10,'xticklabel',{'','','','','','','','','','','','','','','','','','','','','',''},'FontName','Helvetica','FontSize',12);
        set(ax, 'YLim',[-1.46 4],'YTick',-1.46:1.3650:4, 'TickDir','out','TickLength',[0.006/0.5, 0],'yticklabel',{'','1360.5','1361.0','1361.5',''},'FontName','Helvetica','FontSize',12);

    end

    %
    if inum ==5
        ax2 = axes('Position',pos(inum,:),'Color','none');
        set(gca,'XLim',[1 1156],'XTick',[]);
        set(gca,'YAxisLocation','right');
        box off;
        set(gca,'Color','none','XColor','none');
        hold on;
        plot(ax2,1:1156, CH4, '-', 'Color', 'k', 'LineWidth', 1.5, 'LineJoin' ,'miter');

        set(ax2, 'YLim',[0 2000],'YTick',0:500:1500, 'TickDir','out','TickLength',[0.004/0.5, 0], 'fontname','Helvetica','fontsize',12,'yticklabel',{'0','500','1000','1500',''});
        ylabel({'CH4 (ppb)'},'fontname','Helvetica','fontsize',12,'Color',[0 0 0]);   %%%%%%%%%%%%%%%remember change%%%%%%%%%

        ax= axes('Position',pos(inum,:),'Color','none');

        hold on;
        plot(ax,1:1156, CO2, '-', 'Color', [153 0 2]./255, 'LineWidth', 1.5, 'LineJoin' ,'miter');
        hold on;
        plot(ax,1:1156, N2O, '-', 'Color', [210 126 29]./255, 'LineWidth', 1.5, 'LineJoin' ,'miter');

        set(ax, 'YLim',[250 400],'YTick',250:25:400, 'TickDir','out','TickLength',[0.004/0.5, 0], 'fontname','Helvetica','fontsize',12,'yticklabel',{'250','','300','','350','',''});
        set(ax, 'XLim',[1 1156],'XTick',51:50:1156, 'TickDir','out','TickLength',[0.006/0.5, 0], 'fontname','Helvetica','fontsize',10,'xticklabel',{'900','','1000','','1100','','1200','','1300','','1400','','1500','','1600','','1700','','1800','','1900','','2000'},'FontName','Helvetica','FontSize',12);

    end

    hold on;
    ax=gca;
    axes('position',ax.Position,'box','on','ytick',[],'xtick',[],'color','none');
    text(0.01, 0.9, Label{inum},  'FontName','Helvetica','horizontalalignment','left','FontSize',14,'FontWeight','bold');
end

img =gcf;
print(img, '-dtiff', '-r600', 'Revise_Figure2_20241029_30yr.tif');
